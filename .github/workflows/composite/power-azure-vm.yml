name: 'Power ON or DEALLOCATE a specific Azure VM'
description: 'This action either powers on or powers off (deallocates) a specific Azure VM'

branding:
  icon: download
  color: blue

inputs:
  POWER_SWITCH:
    description: 'Turn ON or OFF the VM'
    required: true
    type: boolean
  AZURE_VM_NAME:
    description: 'Name of the VM'
    required: true
    type: string
  AZURE_RG_NAME:
    description: 'Resource Group where the VM lives'
    required: true
    type: string

runs:
  using: "composite"
  steps:
    - name: "Login with az CLI"
      run: |
        az login --service-principal -u ${{ secrets.AZURE_SP_CLIENTID }} --p ${{ secrets.AZURE_SP_SECRET }} --tenant ${{ secrets.AZURE_TENANTID }}
    
    - name: "Deallocate VM"
      if: ${{ ! inputs.POWER_SWITCH }}
      run: | 
        az vm deallocate --name ${{ inputs.AZURE_VM_NAME }} --resource-group ${{ inputs.AZURE_RG_NAME }} --no-wait 

    - name: "Start VM"
      if: ${{ inputs.POWER_SWITCH }}
      run: | 
        az vm start --name ${{ inputs.AZURE_VM_NAME }} --resource-group ${{ inputs.AZURE_RG_NAME }} --no-wait 